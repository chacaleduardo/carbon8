<head>
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
    <meta http-equiv="Content-Type" content="text/html;" />
    <meta name="Generator" content="Xara HTML filter v.8.1.1.474" />
    <meta name="XAR Files" content="supervisorio/blocoh/xr_files.txt" />
    <title>blocoh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="supervisorio/blocoh/xr_fonts.css" />
    <script type="text/javascript">
    <!--
    if (navigator.userAgent.indexOf('MSIE') != -1 || navigator.userAgent.indexOf('Trident') != -1) {
        document.write('<link rel="stylesheet" type="text/css" href="supervisorio/blocoh/xr_fontsie.css"/>');
    }
    -->
    </script>
    <script language="JavaScript" type="text/javascript">
    document.documentElement.className = "xr_bgh0";
    </script>
    <link rel="stylesheet" type="text/css" href="supervisorio/blocoh/xr_main.css" />
    <link rel="stylesheet" type="text/css" href="supervisorio/blocoh/xr_text.css" />
    <link rel="stylesheet" type="text/css" href="supervisorio/blocoh/custom_styles.css" />
    <script type="text/javascript" src="supervisorio/blocoh/roe.js"></script>
    <script type="text/javascript" src="supervisorio/blocoh/replaceMobileFonts.js"></script>
    <script src="../inc/js/jquery/jquery-1.11.2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="supervisorio/blocoh/ani.css" />
</head>
<div style="color: #333;font-size: 18px; float: right;"><?=date("d/m/Y H:i:s");?><br>
 <span id="referencia"></span>

</div>

<div id="xr_td" class="xr_td">
    <div class="xr_ap xr_xri_" style="width: 1000px; height: 760px;">
        <img class="xr_rn_ xr_ap" src="supervisorio/blocog/3.png" title="" style="top: 7px; width: 906px; height: 746px;" />

        <a class="toogleimg">
            <span class="xr_ar 2381" style="left: 148px; top: 30px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2381"></span>
            <div class="Normal_text" style="position: absolute; left:163px; top:45px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2381"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:151px; top: 54px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2381" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:173px; top: 55px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2381" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:190px; top: 54px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2381" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2381" style=" position: absolute; left:148px; top:57px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2382" style="left: 160px; top: 190px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2382"></span>
            <div class="Normal_text" style="position: absolute; left:175px; top:205px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2382"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:163px; top: 214px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2382" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:185px; top: 215px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2382" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:202px; top: 214px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2382" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2382" style=" position: absolute; left:160px; top:217px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2383" style="left: 352px; top: 302px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2383"></span>
            <div class="Normal_text" style="position: absolute; left:367px; top:317px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2383"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:355px; top: 326px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2383" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:377px; top: 327px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2383" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:394px; top: 326px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2383" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2383" style=" position: absolute; left:352px; top:329px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2384" style="left: 455px; top: 241px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2384"></span>
            <div class="Normal_text" style="position: absolute; left:470px; top:256px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2384"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:458px; top: 265px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2384" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:480px; top: 266px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2384" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:497px; top: 265px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2384" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2384" style=" position: absolute; left:455px; top:268px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2386" style="left: 618px; top: 296px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2386"></span>
            <div class="Normal_text" style="position: absolute; left:635px; top:311px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2386"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:621px; top: 320px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2386" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:643px; top: 321px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2386" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:660px; top: 320px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2386" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2386" style=" position: absolute; left:618px; top:323px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2385" style="left: 450px; top: 333px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2385"></span>
            <div class="Normal_text" style="position: absolute; left:465px;  top:348px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2385"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:453px; top: 357px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2385" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:475px; top: 358px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2385" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:492px; top: 357px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2385" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2385" style=" position: absolute; left:450px; top:360px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2389" style="left: 846px; top: 557px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2389"></span>
            <div class="Normal_text" style="position: absolute; left:860px; top:572px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2389"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:849px; top: 581px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2389" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:871px; top: 582px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2389" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:888px; top: 581px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2389" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2389" style=" position: absolute; left:846px; top:584px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2390" style="left: 245px; top: 557px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2390"></span>
            <div class="Normal_text" style="position: absolute; left:260px; top:572px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2390"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:248px; top: 581px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2390" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:270px; top: 582px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2390" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:287px; top: 581px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2390" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2390" style=" position: absolute; left:245px; top:584px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2387" style="left: 245px; top: 665px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2387"></span>
            <div class="Normal_text" style="position: absolute; left:260px; top:680px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2387"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:248px; top: 689px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2387" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:270px; top: 690px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2387" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:287px; top: 689px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2387" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2387" style=" position: absolute; left:245px; top:692px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2391" style="left: 645px; top: 557px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2391"></span>
            <div class="Normal_text" style="position: absolute; left:660px; top:572px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2391"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:648px; top: 581px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2391" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:670px; top: 582px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2391" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:687px; top: 581px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2391" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2391" style=" position: absolute; left:645px; top:584px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>

        <a class="toogleimg">
            <span class="xr_ar 2388" style="left: 645px; top: 665px; width: 60px; height: 19px; background-color: #F8BB00; border: 1px solid #333333;" id="2388"></span>
            <div class="Normal_text" style="position: absolute; left:660px; top:680px; width:24px; height:10px;color:#333333;">
                <span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2388"></span>
            </div>
			<div class="Normal_text  grafana" style="position: absolute;  left:648px; top: 689px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2388" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:670px; top: 690px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2388" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:687px; top: 689px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2388" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2388" style=" position: absolute; left:645px; top:692px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
        </a>
    </div>
</div>

<?

include_once("../inc/php/functions.php");

if($_GET['elemento'] == 'pressao'){
	$variavel = '0hRYmwJMz';
}else if($_GET['elemento'] == 'temperatura' || ($_GET['elemento'] == 'umidade')){
	$variavel = 'PWoKRQ1Mk';
}

$getsala = $_GET['sala'];

$sql = "select 
			d.iddevice, s.idtag,
		IF(s.idtag = '".$getsala."','selecionada','') as salaselecionada
		FROM
			tag s
		join tagsala ts on ts.idtagpai = s.idtag
		join device d on d.idtag = ts.idtag
		WHERE
			s.idtag in (2381,2382,2383,2384,2385,2386,2387,2388,2389,2390,2391)
		and d.status = 'ATIVO'
		and s.status = 'ATIVO'";

$res = d::b()->query($sql);

while ($linha = mysql_fetch_assoc($res))
{
	if ($_GET['elemento'] == 'pressao')
	{
		$sql = "Select 
				dhr.registradoem, if (dhr.registradoem < (NOW() - INTERVAL 5 MINUTE), 'INATIVO', 'ATIVO') as statusleitura,
				ROUND(IF(dhr.pressao > 0 AND dhrr.pressao > 0,
							(dhr.pressao + d.calib_press) - (dhrr.pressao + dr.calib_press),
							0),
						0) AS pressao
				FROM
				laudo.devicehistref dhr
					JOIN
				laudo.device d ON d.iddevice = dhr.iddevice
					JOIN
				laudo.devicehistref dhrr ON dhrr.iddevice = dhr.iddeviceref
					AND dhr.registradoem = dhrr.registradoem
					JOIN
				laudo.device dr ON dr.iddevice = dhrr.iddevice
				WHERE
				d.iddevice = ".$linha['iddevice']."
				ORDER BY dhr.registradoem DESC
				LIMIT 1";

	}else if ($_GET['elemento'] == 'temperatura')
	{
		$sql = "Select
				ROUND(dh.temperatura - calib_temp,0) AS temperatura, dh.registradoem, if (registradoem < (NOW() - INTERVAL 5 MINUTE), 'INATIVO', 'ATIVO') as statusleitura
				FROM
					laudo.devicehist dh
						JOIN
					laudo.device d ON d.mac_address = dh.mac_address
				WHERE
					d.iddevice = ".$linha['iddevice']."
				ORDER BY dh.registradoem DESC
				LIMIT 1";
	}else if ($_GET['elemento'] == 'umidade')
	{ 
		$sql = "Select
				ROUND(dh.umidade - calib_umid,0) AS umidade, dh.registradoem, if (registradoem < (NOW() - INTERVAL 5 MINUTE), 'INATIVO', 'ATIVO') as statusleitura
				FROM
					laudo.devicehist dh
						JOIN
					laudo.device d ON d.mac_address = dh.mac_address
				WHERE
					d.iddevice = ".$linha['iddevice']."
				ORDER BY dh.registradoem DESC
				LIMIT 1";
	}

	$res2 = d::b()->query($sql);

	while ($_row = mysql_fetch_assoc($res2))
	{ 
		$idtagpai = $linha['idtag']; 
		$statusleitura = $_row['statusleitura'];
		$registradoem = $_row['registradoem'];
		$iddevice = $linha['iddevice'];
		$bgcolor='#F8BB00';

		if ($_GET['elemento'] == 'temperatura'){
			$temperatura = $_row['temperatura'];
			$dado = $temperatura.' °C';
		}else if ($_GET['elemento'] == 'pressao'){
			$pressao = $_row['pressao'];
			$dado = $pressao.' Pa';  
		}elseif ($_GET['elemento'] == 'umidade'){ 
			$umidade = $_row['umidade']; 
			$dado = $umidade.' UR';
		}
		
		if ($statusleitura == 'INATIVO'){
			$pressao = '------'; 
			$temperatura = '------'; 
			$umidade = '------';
			$bgcolor='#e74a3b';
		}
		

		if ($linha['salaselecionada'] == "selecionada"){
			$bgcolor='#07fca2';
		}
		
		?>
        <script>
        	$('#referencia').html('<small>Referência: tag-<?='1792';?> <?=$referencia;?></small>');
            $('.<?=$idtagpai;?>').css('background', '<?=$bgcolor;?>');
            $('#content_<?=$idtagpai;?>').html('<?=$dado;?>');
        </script>
    <?}?>

	<script>
		$('#<?=$idtagpai;?>').siblings('.grafana').attr('data-href','http://h1.laudo.io:480/graph/d/<?=$variavel?>/bloco-g-<?=$_GET['elemento']?>?orgId=1').attr('title', 'Grafana');
		$('#<?=$idtagpai;?>').siblings('.detalhes').attr('data-href','https://sislaudo.laudolab.com.br/?_modulo=device&_acao=u&iddevice=<?=$iddevice;?>').attr('title', 'Editar Device');
		$('#<?=$idtagpai;?>').siblings('.relatorio').attr('data-href','https://sislaudo.laudolab.com.br/?_modulo=device').attr('title', 'Relatório Device');
	</script>

	<?
}
?>
<script>

$('.toogleimg').on('mouseover', function(){
	var id = $(this).children('span').attr('id');
	$('.img_'+id).css('display', '');
});
$('.toogleimg').on('mouseout', function(){
	var id = $(this).children('span').attr('id');
	$('.img_'+id).css('display', 'none');
});

$('.grafana').on('click', function(){
	open ($ (this) .data ('href'));
});

$('.detalhes').on('click', function(){
	open ($ (this) .data ('href'));
});

$('.relatorio').on('click', function(){
	open ($ (this) .data ('href'));
});

</script>