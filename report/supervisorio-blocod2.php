<head>
 <meta http-equiv="X-UA-Compatible" content="IE=EDGE"/>
 <meta http-equiv="Content-Type" content="text/html;"/>
 <meta name="Generator" content="Xara HTML filter v.8.1.1.474"/>
 <meta name="XAR Files" content="supervisorio/blocod/xr_files.txt"/>
 <title>blocod</title>
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <link rel="stylesheet" type="text/css" href="supervisorio/blocod/xr_fonts.css"/>
 <script type="text/javascript"><!--
 if(navigator.userAgent.indexOf('MSIE')!=-1 || navigator.userAgent.indexOf('Trident')!=-1){ document.write('<link rel="stylesheet" type="text/css" href="supervisorio/blocod/xr_fontsie.css"/>');}
 --></script>
 <script language="JavaScript" type="text/javascript">document.documentElement.className="xr_bgh0";</script>
 <link rel="stylesheet" type="text/css" href="supervisorio/blocod/xr_main.css"/>
 <link rel="stylesheet" type="text/css" href="supervisorio/blocod/xr_text.css"/>
 <link rel="stylesheet" type="text/css" href="supervisorio/blocod/custom_styles.css"/>
 <script type="text/javascript" src="supervisorio/blocod/roe.js"></script>
 <script type="text/javascript" src="supervisorio/blocod/replaceMobileFonts.js"></script>
<script src="../inc/js/jquery/jquery-1.11.2.min.js"></script>
 <link rel="stylesheet" type="text/css" href="supervisorio/blocod/ani.css"/>
</head>
<div style="color: #333;font-size: 18px; float: right;"><?=date("d/m/Y H:i:s");?><br>
 <span id="referencia"></span>
</div>

<div id="xr_td" class="xr_td">
	<div class="xr_ap xr_xri_" style="width: 1349px; height: 760px;">
		<img class="xr_rn_ xr_ap" src="supervisorio/blocod/blocod.jpg" title="" style="left: 0px; top: 66px; width: 1349px; "/>
		
		<a class="toogleimg">
			<span class="xr_ar 2432" style="left: 176px; top: 165px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2432"></span>
			<div class="Normal_text" style="position:relative; left:190px; top:158px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2432"></span>  
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:179px; top: 189px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2432" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:201px; top: 190px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2432" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:218px; top: 189px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2432" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2432" style=" position: absolute; left:176px; top:192px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>

		<a class="toogleimg">
			<span class="xr_ar 2437" style="left: 103px; top: 226px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2437"></span>
			<div class="Normal_text" style="position:relative; left:117px; top:219px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2437"></span>  
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:107px; top: 281px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2437" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:129px; top: 282px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2437" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:146px; top: 281px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2437" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2437" style=" position: absolute; left:103px; top:284px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>

		<a class="toogleimg">
			<span class="xr_ar 2433" style="left: 303px; top: 146px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2433"></span>
			<div class="Normal_text" style="position:relative; left:317px; top:139px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2433"></span>  
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:306px; top: 233px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2433" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:328px; top: 234px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2433" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:345px; top: 233px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2433" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2433" style=" position: absolute; left:303px; top:235px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>

		<a class="toogleimg">
			<span class="xr_ar 2438" style="left: 500px; top: 120px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2438"></span>
			<div class="Normal_text" style="position:relative; left: 514px; top: 113px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2438"></span> 
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:503px; top: 237px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2438" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:525px; top: 238px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2438" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:542px; top: 237px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2438" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2438" style=" position: absolute; left:500px; top:240px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>
			
		<a class="toogleimg">
			<span class="xr_ar 2434" style="left: 635px; top: 199px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2434"></span>
			<div class="Normal_text" style="position:relative; left: 349px; top: 192px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2434"></span>
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:638px; top: 347px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2434" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:660px; top: 348px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2434" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:677px; top: 347px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2434" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2434" style=" position: absolute; left:635px; top:350px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>

		<a class="toogleimg">
			<span class="xr_ar 2436" style="left: 992px; top: 115px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2436"></span>
			<div class="Normal_text" style="position:relative; left: 1006px; top: 108px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2436"></span> 
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:995px; top: 294px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2436" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:1017px; top: 295px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2436" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:1034px; top: 294px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2436" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2436" style=" position: absolute; left:992px; top:297px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>

		<a class="toogleimg">
			<span class="xr_ar 2435" style="left: 1110px; top: 84px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2435"></span>
			<div class="Normal_text" style="position:relative;left: 1124px; top: 77px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2435"></span>
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:1113px; top: 294px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2435" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:1135px; top: 295px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2435" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:1152px; top: 294px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2435" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2435" style=" position: absolute; left:1110px; top:297px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>

		<a class="toogleimg" target="_blank">
			<span class="xr_ar 2439" style="left: 150px; top: 550px; width: 60px;  height: 19px; position: relative; background-color: #F8BB00; border: 1px solid #333333;" id="2439"></span>
			<div class="Normal_text" style="position:relative; left: 170px; top: 543px; width:24px; height:10px;color:#333333;">
				<span class="xr_tl Normal_text" style="top: -11.77px;color:#333333;" id="content_2439"></span>
			</div>
			<div class="Normal_text  grafana" style="position: absolute;  left:153px; top: 791px; width:24px; height:10px;color:#333333; z-index:9999" data-href="">
				<img class="img_2439" src="supervisorio/grafana.png"  style="display:none;"/>		
			</div>
			<div class="Normal_text  detalhes" style="position: absolute;  left:175px; top: 792px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2439" src="supervisorio/detalhes.png"  style="display:none;"/>	
			</div>
			<div class="Normal_text  relatorio" style="position: absolute; left:192px; top: 791px; width:24px; height:10px;color:#333333; z-index:9999" data-href=""> 
				<img href="" class="img_2439" src="supervisorio/relatorio.png"  style="display:none;"/>	
			</div>
			<span class="img_2439" style=" position: absolute; left:150px; top:794px; width: 60px; height: 19px; background-color: #fff; border: 1px solid #333333; margin-top:-5px; display:none;"></span>
		</a>
	</div>
</div>

<?

include_once("../inc/php/functions.php");


if($_GET['elemento'] == 'temperatura'){
	$variavel = 'PNkIEj1Mz';
}

$getsala = $_GET['sala'];

$sql = "select 
			d.iddevice, s.idtag,
		IF(s.idtag = '".$getsala."','selecionada','') as salaselecionada
		FROM
			tag s
		join tagsala ts on ts.idtagpai = s.idtag
		join device d on d.idtag = ts.idtag
		WHERE
			s.idtag in (2432,2433,2434,2435,2436,2437,2438,2439)
		and d.status = 'ATIVO'
		and s.status = 'ATIVO'";

$res = d::b()->query($sql);

while ($linha = mysql_fetch_assoc($res))
{
	if ($_GET['elemento'] == 'pressao')
	{
		$sql = "Select 
				dhr.registradoem, if (dhr.registradoem < (NOW() - INTERVAL 5 MINUTE), 'INATIVO', 'ATIVO') as statusleitura,
				ROUND(IF(dhr.pressao > 0 AND dhrr.pressao > 0,
							(dhr.pressao + d.calib_press) - (dhrr.pressao + dr.calib_press),
							0),
						0) AS pressao
				FROM
				laudo.devicehistref dhr
					JOIN
				laudo.device d ON d.iddevice = dhr.iddevice
					JOIN
				laudo.devicehistref dhrr ON dhrr.iddevice = dhr.iddeviceref
					AND dhr.registradoem = dhrr.registradoem
					JOIN
				laudo.device dr ON dr.iddevice = dhrr.iddevice
				WHERE
				d.iddevice = ".$linha['iddevice']."
				ORDER BY dhr.registradoem DESC
				LIMIT 1";

	}else if ($_GET['elemento'] == 'temperatura')
	{
		$sql = "Select
				ROUND(dh.temperatura - calib_temp,0) AS temperatura, dh.registradoem, if (registradoem < (NOW() - INTERVAL 5 MINUTE), 'INATIVO', 'ATIVO') as statusleitura
				FROM
					laudo.devicehist dh
						JOIN
					laudo.device d ON d.mac_address = dh.mac_address
				WHERE
					d.iddevice = ".$linha['iddevice']."
				ORDER BY dh.registradoem DESC
				LIMIT 1";
	}else if ($_GET['elemento'] == 'umidade')
	{ 
		$sql = "Select
				ROUND(dh.umidade - calib_umid,0) AS umidade, dh.registradoem, if (registradoem < (NOW() - INTERVAL 5 MINUTE), 'INATIVO', 'ATIVO') as statusleitura
				FROM
					laudo.devicehist dh
						JOIN
					laudo.device d ON d.mac_address = dh.mac_address
				WHERE
					d.iddevice = ".$linha['iddevice']."
				ORDER BY dh.registradoem DESC
				LIMIT 1";
	}

	$res2 = d::b()->query($sql);

	while ($_row = mysql_fetch_assoc($res2))
	{ 
		$idtagpai = $linha['idtag']; 
		$statusleitura = $_row['statusleitura'];
		$registradoem = $_row['registradoem'];
		$iddevice = $linha['iddevice'];
		$bgcolor='#F8BB00';

		if ($_GET['elemento'] == 'temperatura'){
			$temperatura = $_row['temperatura'];
			$dado = $temperatura.' °C';
		}else if ($_GET['elemento'] == 'pressao'){
			$pressao = $_row['pressao'];
			$dado = $pressao.' Pa';  
		}elseif ($_GET['elemento'] == 'umidade'){ 
			$umidade = $_row['umidade']; 
			$dado = $umidade.' UR';
		}
		
		if ($linha['salaselecionada'] == "selecionada"){
			$bgcolor='#07fca2';
        }
        
        if ($statusleitura == 'INATIVO'){
			$pressao = '------'; 
			$temperatura = '------'; 
			$umidade = '------';
			$bgcolor='#e74a3b';
		}
		
		?>
		<script>
			$('.<?=$idtagpai;?>').css('background', '<?=$bgcolor;?>');
			$('#content_<?=$idtagpai;?>').html('<?=$dado;?>');
		</script>
		<?
	}

	?>
	<script>
		$('#<?=$idtagpai;?>').siblings('.grafana').attr('data-href','http://h1.laudo.io:480/graph/d/<?=$variavel?>/bloco-d-temperatura-quartos-e-camaras?orgId=1').attr('title', 'Grafana');
		$('#<?=$idtagpai;?>').siblings('.detalhes').attr('data-href','https://sislaudo.laudolab.com.br/?_modulo=device&_acao=u&iddevice=<?=$iddevice;?>').attr('title', 'Editar Device');
		$('#<?=$idtagpai;?>').siblings('.relatorio').attr('data-href','https://sislaudo.laudolab.com.br/?_modulo=device').attr('title', 'Relatório Device');
	</script>

	<?
}
?>

<script>

$('.toogleimg').on('mouseover', function(){
	var id = $(this).children('span').attr('id');
	$('.img_'+id).css('display', '');
});
$('.toogleimg').on('mouseout', function(){
	var id = $(this).children('span').attr('id');
	$('.img_'+id).css('display', 'none');
});

$('.grafana').on('click', function(){
	open ($ (this) .data ('href'));
});

$('.detalhes').on('click', function(){
	open ($ (this) .data ('href'));
});

$('.relatorio').on('click', function(){
	open ($ (this) .data ('href'));
});

</script>